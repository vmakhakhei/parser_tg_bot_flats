# üìã –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞

## –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### ‚úÖ Black
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É PEP 8
- –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏: 100 —Å–∏–º–≤–æ–ª–æ–≤
- –í—Å–µ —Ñ–∞–π–ª—ã –≤ `bot/` –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω—ã

### ‚úÖ Flake8
- –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏: 100 —Å–∏–º–≤–æ–ª–æ–≤
- –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ –æ—à–∏–±–∫–∏: E501, E203, W503 (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å black), F541 (f-—Å—Ç—Ä–æ–∫–∏), C901 (—Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π)

### ‚úÖ Type Hints
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ç–∏–ø—ã –∏–∑ `typing`: `List`, `Dict`, `Any`, `Optional`, `Tuple`
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç —è–≤–Ω—ã–µ —Ç–∏–ø—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–π
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ (–º–∞–∫—Å–∏–º—É–º 30-40 —Å—Ç—Ä–æ–∫)
- –î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏
- –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –§–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- `bot/services/search_service.py` - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω
- `bot/services/ai_service.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
- `bot/services/notification_service.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
- `bot/handlers/*.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
- `bot/middlewares/*.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### search_service.py
- **–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
  - `matches_user_filters`: ~80 —Å—Ç—Ä–æ–∫
  - `check_new_listings`: ~90 —Å—Ç—Ä–æ–∫
  
- **–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
  - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ < 40 —Å—Ç—Ä–æ–∫
  - –†–∞–∑–±–∏—Ç—ã –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏:
    - `_check_rooms_filter()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º
    - `_check_price_filter()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ü–µ–Ω–µ
    - `_check_seller_type_filter()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ç–∏–ø—É –ø—Ä–æ–¥–∞–≤—Ü–∞
    - `_get_cached_listings()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞
    - `_parse_and_cache_listings()` - –ø–∞—Ä—Å–∏–Ω–≥ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    - `_process_listing_for_user()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    - `_process_user_listings_normal_mode()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (F401)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `handlers/start.py`

### F-—Å—Ç—Ä–æ–∫–∏ –±–µ–∑ placeholders (F541)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã f-—Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `ai_service.py`

### Bare except (E722)
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `except Exception:` –≤ `notification_service.py`

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (F841)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `e` –≤ `telegram_api.py`

## –û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (C901 - —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π)

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –≤—ã—Å–æ–∫—É—é —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –Ω–æ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∏—Ö –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —á–∞—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:

- `RateLimitMiddleware.__call__` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 26
- `SpamProtectionMiddleware.__call__` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 26
- `evaluate_and_compare_new_listings` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 18
- `check_new_listings_ai_mode` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 39
- `format_listing_message` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 26
- `send_listing_to_user` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 14
- `safe_send_message` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 13
- `safe_edit_message_text` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å 11

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º, –Ω–æ —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (—Ñ—É–Ω–∫—Ü–∏–∏ < 40 —Å—Ç—Ä–æ–∫).

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

**–í–∞–∂–Ω–æ:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞!

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "/Users/vmakhakei/TG BOT"

# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
./check_code_quality.sh

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
python3 -m black bot/ --line-length=100

# –õ–∏–Ω—Ç–∏–Ω–≥
python3 -m flake8 bot/ --max-line-length=100 --ignore=E501,E203,W503,F541,C901

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python3 -m mypy bot/ --ignore-missing-imports
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É "Path 'bot/' does not exist", —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∞–π–ª `main.py`)
2. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `bot/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python3 -m black` –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ `black`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- Black –ø—Ä–∏–º–µ–Ω–µ–Ω –∫–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º
- Flake8 –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (–∫—Ä–æ–º–µ C901 - —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π)
- Type hints –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–µ–∑–¥–µ
- –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ —á–∞—Å—Ç–∏ (< 40 —Å—Ç—Ä–æ–∫)
