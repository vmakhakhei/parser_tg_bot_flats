# Тесты для сервисов

## test_search_service.py

Тесты для бизнес-логики поиска и фильтрации объявлений.

### Покрытие тестами

#### ✅ Фильтрация (TestFiltering) - 20 тестов

1. **Фильтрация по комнатам:**
   - Минимальное количество комнат
   - Максимальное количество комнат
   - Валидные значения
   - Нулевое количество комнат (не применяется фильтр)

2. **Фильтрация по цене:**
   - Минимальная цена
   - Максимальная цена
   - Валидные значения
   - Цена в USD
   - Цена в BYN с конвертацией
   - Нулевая цена (не применяется фильтр)

3. **Фильтрация по типу продавца:**
   - Только собственники
   - Только агентства
   - Фильтр не установлен
   - Неизвестный тип продавца

4. **Комбинированная фильтрация:**
   - Все фильтры проходят
   - Один фильтр не проходит

5. **Граничные значения:**
   - Комнаты на границе диапазона
   - Цена на границе диапазона

#### ✅ Сортировка (TestSorting) - 3 теста

1. Сортировка по цене по возрастанию
2. Сортировка с нулевой ценой (в конце)
3. Стабильность сортировки (одинаковые цены)

#### ✅ Обработка пустых результатов (TestEmptyResults) - 6 тестов

1. Пустой список объявлений
2. Нет объявлений, соответствующих фильтрам
3. Пустые фильтры (используются значения по умолчанию)
4. None фильтры (валидация)
5. Фильтры без города (валидация)
6. Все объявления отфильтрованы

#### ✅ Дополнительные тесты

1. **Валидация фильтров (validate_user_filters):**
   - Пустые фильтры
   - Фильтры без города

2. **Счетчики фильтрации:**
   - Сброс счетчиков
   - Инициализация счетчиков

3. **Функция fetch_listings_for_user:**
   - Проверка существования функции и сигнатуры

### Запуск тестов

```bash
# Все тесты для search_service
pytest tests/services/test_search_service.py -v

# Конкретный класс тестов
pytest tests/services/test_search_service.py::TestFiltering -v

# Конкретный тест
pytest tests/services/test_search_service.py::TestFiltering::test_filter_by_rooms_min -v
```

### Статистика

- **Всего тестов:** 30
- **Пройдено:** 30 ✅
- **Провалено:** 0
- **Покрытие:** Фильтрация, сортировка, обработка пустых результатов

### Особенности

- Все тесты изолированы и не требуют реальных зависимостей
- Используются моки для изоляции тестируемого кода
- Тесты проверяют граничные случаи и edge cases
- Покрыты все основные сценарии фильтрации
