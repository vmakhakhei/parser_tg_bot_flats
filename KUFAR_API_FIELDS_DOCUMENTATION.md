# Документация полей API Kufar для объявлений о квартирах

## Структура ответа API

API возвращает объект со следующими полями верхнего уровня:

- **`ads`** - массив объявлений (до 30 на страницу)
- **`total`** - общее количество объявлений, соответствующих запросу
- **`pagination`** - объект пагинации с информацией о страницах

---

## Прямые поля объявления (верхний уровень)

### Основные идентификаторы

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `ad_id` | int | Уникальный ID объявления | `1048044245` |
| `ad_link` | string | Полная ссылка на объявление | `"https://re.kufar.by/vi/1048044245"` |
| `list_id` | int | ID списка (обычно равен ad_id) | `1048044245` |
| `message_id` | string | ID сообщения | `"adid1048044245"` |
| `account_id` | string | ID аккаунта продавца | `"OgviMDxOPigerbtUWuzr05k"` |

### Цены

| Поле | Тип | Описание | Пример | Примечание |
|------|-----|----------|--------|------------|
| `price_usd` | string | Цена в USD в **центах** | `"1895000"` | **ВАЖНО:** Нужно делить на 100 для получения долларов |
| `price_byn` | string | Цена в BYN в **копейках** | `"5508386"` | **ВАЖНО:** Нужно делить на 100 для получения рублей |
| `currency` | string | Валюта объявления | `"USD"` или `"BYN"` |
| `remuneration_type` | string | Тип оплаты | `"1"` | `"1"` = цена, другие значения = другие типы оплаты |

### Даты и время

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `list_time` | string | Дата создания объявления в формате ISO 8601 | `"2026-01-16T14:23:57Z"` |
| `list_time_text` | string | Текстовая дата (если есть) | `"сегодня"`, `"вчера"`, `"X дней назад"` |

### Текстовые поля

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `subject` | string | Заголовок объявления | `"1-комнатная квартира м-н Южный"` |
| `body` | string/null | Полное описание объявления | `null` или текст описания |
| `body_short` | string | Краткое описание (первые ~200 символов) | `"СРОЧНАЯ ПРОДАЖА | БЕЗ ТОРГА..."` |

### Категория и тип

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `category` | string | Категория объявления | `"1010"` | `1010` = квартиры |
| `type` | string | Тип сделки | `"sell"` | `"sell"` = продажа |

### Информация о продавце

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `company_ad` | boolean | Флаг: `true` = объявление от агентства, `false` = от собственника | `true` |
| `is_mine` | boolean | Флаг: принадлежит ли объявление текущему пользователю | `false` |
| `phone_hidden` | boolean | Скрыт ли телефон | `false` |

### Изображения

| Поле | Тип | Описание | Структура |
|------|-----|----------|-----------|
| `images` | array | Массив объектов изображений | Каждый объект содержит: `id`, `path`, `media_storage`, `yams_storage` |

**Структура объекта изображения:**
```json
{
  "id": "0000",
  "media_storage": "rms",
  "path": "adim1/89adfb50-dcd0-4715-9908-b72a2a0ffca9.jpg",
  "yams_storage": false
}
```

**Примечание:** Для получения полного URL изображения нужно использовать: `https://rms.kufar.by/v1/{path}`

### Дополнительные поля

| Поле | Тип | Описание |
|------|-----|----------|
| `feedback_info` | object/null | Информация об отзывах (обычно `null`) |
| `paid_services` | object | Платные услуги для объявления |
| `show_parameters` | object | Параметры отображения (показывать ли телефон, чат и т.д.) |

**Структура `paid_services`:**
```json
{
  "halva": false,
  "highlight": false,
  "polepos": false,
  "ribbons": "ribbons_discount"
}
```

**Структура `show_parameters`:**
```json
{
  "show_call": true,
  "show_chat": false,
  "show_import_link": false,
  "show_web_shop_link": false
}
```

---

## AD_PARAMETERS (параметры объявления)

Это массив объектов, каждый объект содержит:
- **`p`** - код параметра (ключ)
- **`v`** - значение параметра
- **`vl`** - текстовое значение (человекочитаемое)
- **`pl`** - название параметра на русском языке
- **`pu`** - короткий код параметра (для URL)
- **`g`** - группы параметров (опционально)

### Основные параметры квартиры

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `rooms` | string | Количество комнат | `"1"`, `"2"`, `"3"` |
| `size` | float | Общая площадь в м² | `27.4`, `34.4` |
| `size_living_space` | float | Жилая площадь в м² | `12.6`, `19.6` |
| `size_kitchen` | float | Площадь кухни в м² | `5.7`, `6.0` |
| `size_snb` | float | Площадь санузла и балкона (если есть) | `26.8` |
| `square_meter` | int | Цена за м² в USD | `692`, `724`, `810` |

### Этаж и этажность

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `floor` | array[int] | Этаж квартиры (массив с одним элементом) | `[3]`, `[5]`, `[1]` |
| `re_number_floors` | string | Общее количество этажей в доме | `"5"`, `"9"` |
| `not_first_floor` | boolean | Не первый этаж | `true`, `false` |
| `not_last_floor` | boolean | Не последний этаж | `true`, `false` |

### Год постройки

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `year_built` | int | Год постройки дома | `1986`, `1978`, `1989` |

### Адрес и местоположение

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `coordinates` | array[float] | Координаты [долгота, широта] | `[26.021086, 53.117016]` |
| `address_tags_yandex` | array[string] | Иерархия адреса для Яндекс (страна → область → город → улица) | `["country-belarus~province-brestskaja_oblast~locality-baranovichi~street-kommunisticheskaja_ulica", ...]` |
| `region` | int | ID региона | `1` (Брестская область) |
| `area` | string | ID района/города | `"37"` (Барановичи) |

### Характеристики квартиры

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `bathroom` | string | Тип санузла | `"1"` = раздельный, `"2"` = совмещенный |
| `balcony` | string | Наличие балкона | `"1"` = есть, `"2"` = нет |
| `condition` | string | Состояние | `"1"` = вторичное жилье |
| `flat_repair` | string | Состояние ремонта | `"1"` = требует ремонта, другие значения = другие состояния |

### Характеристики дома

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `house_type` | string | Тип дома | `"3"` = кирпичный, другие значения = другие типы |

### Дополнительные параметры

| Параметр (`p`) | Тип значения | Описание |
|----------------|--------------|----------|
| `type` | string | Тип сделки | `"sell"` = продажа |
| `category` | int | Категория | `1010` = квартиры |
| `remuneration_type` | string | Тип оплаты | `"1"` = цена |
| `content_video` | string | Ссылка на видео (если есть) | URL YouTube или другой видеохостинг |

---

## ACCOUNT_PARAMETERS (параметры аккаунта продавца)

Это массив объектов с той же структурой, что и `ad_parameters`.

### Основные параметры аккаунта

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `name` | string | Название компании или имя продавца | `"''Этажи Барановичи''"`, `"АН РИАЛИТИ"` |
| `address` | string | Адрес продавца (может совпадать с адресом квартиры) | `"Коммунистическая ул, Барановичи, Брестская область"` |
| `contact_person` | string | Контактное лицо | `"Алла"`, `"Елена"`, `"Владислав"` |

### Параметры компании (если `company_ad = true`)

| Параметр (`p`) | Тип значения | Описание | Пример значения |
|----------------|--------------|----------|------------------|
| `company_number` | string | Номер лицензии компании | `"МЮ РБ 48250000081576 от 08.01.2025г."` |
| `vat_number` | string | УНП (Учетный номер плательщика) | `"291872500"`, `"291267309"` |
| `company_address` | string | Юридический адрес компании | `"г. Барановичи, пер. Советский 3-й, д.5, каб.11"` |

---

## Примеры использования

### Получение цены в USD

```python
price_usd_cents = int(ad.get("price_usd", "0"))
price_usd = price_usd_cents // 100  # Делим на 100
```

### Получение этажа

```python
floor_param = None
for param in ad.get("ad_parameters", []):
    if param.get("p") == "floor":
        floor_value = param.get("v", [])
        if isinstance(floor_value, list) and floor_value:
            floor_param = floor_value[0]
        break
```

### Получение года постройки

```python
year_built = None
for param in ad.get("ad_parameters", []):
    if param.get("p") == "year_built":
        year_built = param.get("v")
        break
```

### Получение площади

```python
area = None
for param in ad.get("ad_parameters", []):
    if param.get("p") == "size":
        area = float(param.get("v", 0))
        break
```

### Получение адреса из account_parameters

```python
address = None
for param in ad.get("account_parameters", []):
    if param.get("p") == "address":
        address = param.get("v")
        break
```

### Получение URL изображения

```python
images = ad.get("images", [])
if images:
    first_image_path = images[0].get("path")
    image_url = f"https://rms.kufar.by/v1/{first_image_path}"
```

---

## Важные замечания

1. **Цены:** `price_usd` и `price_byn` хранятся в центах/копейках, нужно делить на 100
2. **Этаж:** Может быть массивом `[3]` или числом, нужно проверять тип
3. **Описание:** Поле `body` часто бывает `null`, используйте `body_short` как альтернативу
4. **Адрес:** Может быть в `account_parameters` (параметр `address`), а не в `ad_parameters`
5. **Год постройки:** Используйте параметр `year_built` из `ad_parameters`, а не ищите в других местах
6. **Изображения:** Путь в `path` относительный, нужно добавлять базовый URL `https://rms.kufar.by/v1/`
