# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ - –æ—Ç—á–µ—Ç

## –î–∞—Ç–∞: 2026-01-18

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏

### ‚úÖ –®–ê–ì 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö

**–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:** `List[Listing]`

- ‚úÖ –í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `List[Listing]` (–Ω–µ dict, –Ω–µ DTO)
- ‚úÖ `aggregator.fetch_all_listings()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `List[Listing]`
- ‚úÖ `search_service.fetch_listings_for_user()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `List[Listing]`
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `Listing` –æ–±—ä–µ–∫—Ç–∞–º–∏
- ‚úÖ `ListingDTO` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `None` –≤ aggregator (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å list)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Listing)

### ‚úÖ –®–ê–ì 2: –£–ª—É—á—à–µ–Ω aggregator

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –ö–∞–∫–æ–π scraper –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –°–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–Ω –≤–µ—Ä–Ω—É–ª
- ‚úÖ –ï—Å–ª–∏ scraper –≤–µ—Ä–Ω—É–ª `None` - —ç—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π
- ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —è–≤–Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `scrapers/aggregator.py`:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `if listings is None` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ scraper'–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

### ‚úÖ –®–ê–ì 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot/services/search_service.py`:**

1. **–§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ:**
   - –û—Å–ª–∞–±–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä: –µ—Å–ª–∏ `max_price < 10000`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 1000000
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

2. **–§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º:**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ `max_rooms < min_rooms`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:**
   - –ï—Å–ª–∏ `price <= 0` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
   - –ï—Å–ª–∏ `rooms <= 0` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

### ‚úÖ –®–ê–ì 4: –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–õ–æ–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `search_service.py`:**

1. **–í `_parse_and_cache_listings()`:**
   - –°–∫–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤–µ—Ä–Ω—É–ª–∏ –ø–∞—Ä—Å–µ—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `None` –æ—Ç aggregator
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∫—ç—à–∞ –∏ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π

2. **–í `_process_user_listings_normal_mode()`:**
   - –°–∫–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –°–∫–æ–ª—å–∫–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
   - –°–∫–æ–ª—å–∫–æ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –°–∫–æ–ª—å–∫–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –°–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö

3. **–í `check_new_listings()`:**
   - –°–∫–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–í—Å–µ –ª–æ–≥–∏ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `[user_{user_id}]` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.**

### ‚úÖ –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
- ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö —Å–æ–±–ª—é–¥–µ–Ω –≤–µ–∑–¥–µ
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç—Ç–∞–ø–∞—Ö

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç:**
- –ï—Å–ª–∏ —Å–∞–π—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí scraper –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –ï—Å–ª–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π 0 ‚Üí —ç—Ç–æ —è–≤–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ —Å –ø—Ä–∏—á–∏–Ω–æ–π

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `scrapers/aggregator.py`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `None`
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

2. `bot/services/search_service.py`
   - –û—Å–ª–∞–±–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏—Ö)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `None` –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:**
- –ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö (`List[Listing]`)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `None`, —Ç–∏–ø—ã)
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- –û—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—Ç—Å–µ—á–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å—è—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ
